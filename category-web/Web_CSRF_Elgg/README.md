# CSRF Lab


## Issues with the newer Firefox versions (9/9/2023)

We found out that newer version of Firefox (e.g., 117.0) 
have behaviors that block the cross-site cookies for 
certain GET requests. For example, the GET requests generated 
from the image tag will not attach the cross-site cookies,
but the cookies will be attached for the GET requests generated 
from the clicking. This behavior is similar to the 
same-site cookies, but it seems that Firefox applies the 
same rule to the normal cookies as well. We have added a special 
note in the description about this situation.

Firefox also has "memory". If the cookies are sent in other types of 
GET requests, then even for the GET requests generated by the 
image tag, the cookies will still be sent out. This behavior is 
different from the same-site cookies. 
The memory is not part of the cache or history, 
so cleaning the cache/history will not remove it.
We have conducted experiments to confirm our observations.
Firefox stores data in the `~/.mozilla/firefox` folder. By restoring the 
files there, we can remove the "memory". 


## Porting to Ubuntu 20.04

This lab works on both Ubuntu 16.04 and 20.04 VM.
We didn't change any existing attack tasks when porting this 
lab to Ubuntu 20.04 VM. 

For the countermeasure, we revised the secret token 
section, because the Elgg program has changed. We added 
a new task on samesite cookies. 


## For Container Setup

We have moved the Elgg setup to containers, and our Ubuntu 20.04 VM
will no longer host the Elgg website. Since we only need
a browser on the VM, this lab can be done using
generic machines, no longer depending on our VM.


